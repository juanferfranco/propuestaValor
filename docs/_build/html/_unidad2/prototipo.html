<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unidad 2. Protocolos ASCII &mdash; documentación de Proyecto propuesta de creación de valor - rc</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="prev" title="Unidad 1. Software para sistemas embebidos" href="../_unidad1/referentes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Proyecto propuesta de creación de valor
          </a>
              <div class="version">
                2022.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SECCIONES</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../_intro/intro.html">Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_unidad1/referentes.html">Referentes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Prototipo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduccion">Introducción</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#propositos-de-aprendizaje">Propósitos de aprendizaje</a></li>
<li class="toctree-l3"><a class="reference internal" href="#temas">Temas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#trayecto-de-actividades">Trayecto de actividades</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ejercicios">Ejercicios</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ejercicio-1-repaso-rapido-de-poo">Ejercicio 1: repaso rápido de POO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ejercicio-2-comunicacion-computador-controlador">Ejercicio 2: comunicación computador-controlador</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ejercicio-3-experimento">Ejercicio 3: experimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ejercicio-4-eventos-externos">Ejercicio 4: eventos externos</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ejercicio-5-caracter-de-fin-de-mensaje">Ejercicio 5: carácter de fin de mensaje</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ejercicio-6-retrieval-practice">Ejercicio 6: retrieval practice</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reto-1-protocolo-ascii">RETO 1: protocolo ASCII</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reto-2-modificacion-de-una-aplicacion-interactiva">RETO 2: modificación de una aplicación interactiva</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#evaluacion-de-la-unidad">Evaluación de la unidad</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enunciado">Enunciado</a></li>
<li class="toctree-l3"><a class="reference internal" href="#que-debes-entregar">¿Qué debes entregar?</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Proyecto propuesta de creación de valor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Unidad 2. Protocolos ASCII</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_unidad2/prototipo.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="unidad-2-protocolos-ascii">
<h1>Unidad 2. Protocolos ASCII<a class="headerlink" href="#unidad-2-protocolos-ascii" title="Permalink to this heading"></a></h1>
<section id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Permalink to this heading"></a></h2>
<p>En la unidad anterior te has concentrado en
la construcción de software para sistemas embebidos.
En esta unidad aprenderás como integrar a una plataforma
de cómputo interactiva dichos sistemas embebidos mediante
el uso de protocolos de comunicación ASCII.</p>
<section id="propositos-de-aprendizaje">
<h3>Propósitos de aprendizaje<a class="headerlink" href="#propositos-de-aprendizaje" title="Permalink to this heading"></a></h3>
<p>Construir aplicaciones interactivas que integren información
del mundo exterior mediante el intercambio de información
codificada en ASCII.</p>
</section>
<section id="temas">
<h3>Temas<a class="headerlink" href="#temas" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Repaso rápido de algunos concepto de la programación orientada
a objetos.</p></li>
<li><p>Técnicas de programación del lado del embebidos y el PC.</p></li>
<li><p>Construcción de aplicaciones interactivas en el computador.</p></li>
</ul>
</section>
</section>
<section id="trayecto-de-actividades">
<h2>Trayecto de actividades<a class="headerlink" href="#trayecto-de-actividades" title="Permalink to this heading"></a></h2>
<section id="ejercicios">
<h3>Ejercicios<a class="headerlink" href="#ejercicios" title="Permalink to this heading"></a></h3>
<section id="ejercicio-1-repaso-rapido-de-poo">
<h4>Ejercicio 1: repaso rápido de POO<a class="headerlink" href="#ejercicio-1-repaso-rapido-de-poo" title="Permalink to this heading"></a></h4>
<p>Piensa en las siguientes preguntas:</p>
<ul>
<li><p>¿Cuál es la diferencia entre una clase y un objeto?</p></li>
<li><p>Asume que dentro de un método tienes lo siguiente:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">classType</span><span class="w"> </span><span class="kt">var</span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">classType</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>¿En qué parte de la memoria queda almacenada var?</p></li>
<li><p>¿En qué parte de la memoria queda almacenado el objeto?</p></li>
<li><p>¿Para qué sirve new?</p></li>
<li><p>¿Para qué sirve el constructor de una clase?</p></li>
</ul>
</li>
</ul>
<p>Considera el siguiente código donde crearemos dos perros Huskies.
Uno se llamará Pepe y el otro Tom. El color de los ojos de Pepe
será azul. A Tom lo crearemos copiando a Pepe y luego le cambiaremos el
color de los ojos a café.</p>
<p>Al ejecutar el código el resultado es:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pepe has a brown color on his right eye, and a brown color on his left eye.
tom has a brown color on his right eye, and a brown color on his left eye.
</pre></div>
</div>
<ul class="simple">
<li><p>¿Por qué ocurre esto?</p></li>
<li><p>¿Cómo podrías independizar los objetos?</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>ALERTA DE SPOLIER</p>
<p>Una posible solución al problema de una mala clonación de perritos.</p>
</div>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span><span class="w"></span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Eye</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Color</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Husky</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Eye</span><span class="w"> </span><span class="n">RightEye</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Eye</span><span class="w"> </span><span class="n">LeftEye</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Husky</span><span class="w"> </span><span class="nf">CopyHusky</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">newDog</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Husky</span><span class="w"> </span><span class="p">{</span><span class="n">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">LeftEye</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">LeftEye</span><span class="p">,</span><span class="w"> </span><span class="n">RightEye</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">RightEye</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newDog</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">ToStringDog</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0} has a {1} color on his right eye, and a {2} color on his left eye.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="n">RightEye</span><span class="p">.</span><span class="n">Color</span><span class="p">,</span><span class="n">LeftEye</span><span class="p">.</span><span class="n">Color</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MainClass</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">pepe</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Husky</span><span class="w"> </span><span class="p">{</span><span class="n">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Pepe&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LeftEye</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Eye</span><span class="p">(),</span><span class="w"> </span><span class="n">RightEye</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Eye</span><span class="p">()};</span><span class="w"></span>
<span class="w">        </span><span class="n">pepe</span><span class="p">.</span><span class="n">LeftEye</span><span class="p">.</span><span class="n">Color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pepe</span><span class="p">.</span><span class="n">RightEye</span><span class="p">.</span><span class="n">Color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tom</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pepe</span><span class="p">.</span><span class="n">CopyHusky</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">tom</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">tom</span><span class="p">.</span><span class="n">LeftEye</span><span class="p">.</span><span class="n">Color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tom</span><span class="p">.</span><span class="n">RightEye</span><span class="p">.</span><span class="n">Color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;brown&quot;</span><span class="p">;</span><span class="w"></span>


<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">pepe</span><span class="p">.</span><span class="n">ToStringDog</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">tom</span><span class="p">.</span><span class="n">ToStringDog</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="ejercicio-2-comunicacion-computador-controlador">
<h4>Ejercicio 2: comunicación computador-controlador<a class="headerlink" href="#ejercicio-2-comunicacion-computador-controlador" title="Permalink to this heading"></a></h4>
<p>La idea de este ejercicio es comunicar a través del puerto serial
un computador con un controlador, en este caso un ESP32. La aplicación del computador
la construirás usando una plataforma de creación de contenido digital interactivo llamada
Unity 2021 LTS.</p>
<p>Estudia con detenimiento el código para el controlador y para el computador. Busca la definición
de todas las funciones usadas en la documentación de Arduino y de Microsoft.</p>
<ul class="simple">
<li><p>¿Quién debe comenzar primero, el computador o el controlador? ¿Por qué?</p></li>
</ul>
<p>Programa el ESP32 con este código:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">()){</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="p">){</span><span class="w"></span>
<span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello from ESP32&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Prueba la aplicación con ScriptCommunicator. ¿Cómo funciona?</p>
<p>Ahora crea un proyecto en Unity 2021 LTS. Antes de continuar
con la escritura del código configura:</p>
<ul class="simple">
<li><p>La herramienta que usarás para editar tus programas. En este caso
usarás Rider. Recuerda que este paso lo puedes hacer en el menú
Edit, Preferences, External Tools y seleccionar Rider en la opción
External Script Editor. Si estás trabajando en Windows puedes seleccionar
Visual Studio.</p></li>
<li><p>Configura un scripting backend que permita soportar las comunicaciones
seriales con el controlador. Ve al menú Edit, Project Settings, Player,
Other Settings, busca la opción Scripting backend y selecciona Mono, luego
busca API Compatibility Level y seleccionar .NET Framework.</p></li>
</ul>
<p>Crea un nuevo C# Script y un Game Object. Añade el Script al GameObject.
Ve al menu Assets y luego selecciona Open C# Project.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.IO.Ports</span><span class="p">;</span><span class="w"></span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Serial</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">SerialPort</span><span class="w"> </span><span class="n">_serialPort</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SerialPort</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="p">[</span><span class="m">32</span><span class="p">];</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">PortName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;/dev/ttyUSB0&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BaudRate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">115200</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">DtrEnable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Open Serial Port&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">A</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="m">0</span><span class="n">x31</span><span class="p">};</span><span class="w"> </span><span class="c1">// or byte[] data = {&#39;1&#39;};</span>
<span class="w">            </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Send Data&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">B</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BytesToRead</span><span class="w"> </span><span class="p">&gt;=</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Receive Data&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Analiza:</p>
<ul class="simple">
<li><p>¿Por qué es importante considerar las propiedades PortName y BaudRate?</p></li>
<li><p>¿Qué relación tienen las propiedades anteriores con el ESP32?</p></li>
</ul>
</section>
<section id="ejercicio-3-experimento">
<h4>Ejercicio 3: experimento<a class="headerlink" href="#ejercicio-3-experimento" title="Permalink to this heading"></a></h4>
<p>(Si quires ver antes unos videos cortos donde te explico
un poco más el ejercicio te dejo
<a class="reference external" href="https://youtube.com/playlist?list=PLX4ZVWZsOgzST9kfU9_ohOUYp_oDo2z48">este</a> link).</p>
<p>Ahora realiza este experimento. Modifica la aplicación del PC así:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.IO.Ports</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">TMPro</span><span class="p">;</span><span class="w"></span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Serial</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">SerialPort</span><span class="w"> </span><span class="n">_serialPort</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SerialPort</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="p">[</span><span class="m">32</span><span class="p">];</span><span class="w"></span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">TextMeshProUGUI</span><span class="w"> </span><span class="n">myText</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">PortName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;/dev/ttyUSB0&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BaudRate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">115200</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">DtrEnable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Open Serial Port&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">myText</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">counter</span><span class="p">++;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">A</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="m">0</span><span class="n">x31</span><span class="p">};</span><span class="w"> </span><span class="c1">// or byte[] data = {&#39;1&#39;};</span>
<span class="w">            </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">numData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Bytes received: &quot;</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">numData</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Debe adicionar a la aplicación un elemento de GUI tipo Text - TextMeshPro y
y luego arrastrar una referencia a este elemento a myText (si no sabes
cómo hacerlo llama al profe).</p>
<p>Y la aplicación del ESP32:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">()){</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="p">){</span><span class="w"></span>
<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello from ESP32&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Ejecuta la aplicación en Unity. Verás un número cambiar rápidamente
en pantalla. Ahora presiona la tecla A (no olvides dar click en
la pantalla Game). ¿Qué pasa? ¿Por qué crees que ocurra esto?</p>
<div class="admonition tip">
<p class="admonition-title">Truco</p>
<p>MUY IMPORTANTE</p>
<p>¿Viste entonces que la aplicación se bloquea? Este comportamiento
es inaceptable para una aplicación interactiva de tiempo real.</p>
</div>
<p>¿Cómo podemos corregir el comportamiento anterior?</p>
<p>Prueba con el siguiente código, luego ANALIZA CON DETENIMIENTO.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.IO.Ports</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">TMPro</span><span class="p">;</span><span class="w"></span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Serial</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">SerialPort</span><span class="w"> </span><span class="n">_serialPort</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SerialPort</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="p">[</span><span class="m">32</span><span class="p">];</span><span class="w"></span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">TextMeshProUGUI</span><span class="w"> </span><span class="n">myText</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">PortName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;/dev/ttyUSB0&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BaudRate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">115200</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">DtrEnable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Open Serial Port&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">myText</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">counter</span><span class="p">++;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">A</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="m">0</span><span class="n">x31</span><span class="p">};</span><span class="w"> </span><span class="c1">// or byte[] data = {&#39;1&#39;};</span>
<span class="w">            </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BytesToRead</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">numData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Bytes received: &quot;</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">numData</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>¿Funciona? ¿Qué pasaría si al momento de ejecutar la instrucción
<code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">numData</span> <span class="pre">=</span> <span class="pre">_serialPort.Read(buffer,</span> <span class="pre">0,</span> <span class="pre">20);</span></code> solo han llegado
10 de los 16 bytes del mensaje? ¿Cómo puede hacer tu programa para
saber que ya tiene el mensaje completo?</p>
<p>¿Cómo podrías garantizar que antes de hacer la operación Read tengas
los 16 bytes listos para ser leídos?</p>
<p>Y si los mensajes que envía el ESP32 tienen tamaños diferentes ¿Cómo
haces para saber que el mensaje enviado está completo o faltan
bytes por recibir?</p>
</section>
<section id="ejercicio-4-eventos-externos">
<h4>Ejercicio 4: eventos externos<a class="headerlink" href="#ejercicio-4-eventos-externos" title="Permalink to this heading"></a></h4>
<p>Nota que en los experimentos anteriores el PC primero le pregunta al
ESP32 (le manda un <code class="docutils literal notranslate"><span class="pre">1</span></code>) por datos. ¿Y si el PC no pregunta? Realiza
el siguiente experimento. Programa ambos códigos y analiza su funcionamiento.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">task</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TaskStates</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">INIT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">WAIT_INIT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">SEND_EVENT</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">TaskStates</span><span class="w"> </span><span class="n">taskState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TaskStates</span><span class="o">::</span><span class="n">INIT</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">u_int32_t</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">taskState</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">TaskStates</span><span class="o">::</span><span class="no">INIT</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">taskState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TaskStates</span><span class="o">::</span><span class="n">WAIT_INIT</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">TaskStates</span><span class="o">::</span><span class="no">WAIT_INIT</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">previous</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Force to send the first value immediately</span>
<span class="w">        </span><span class="n">taskState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TaskStates</span><span class="o">::</span><span class="n">SEND_EVENT</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">TaskStates</span><span class="o">::</span><span class="no">SEND_EVENT</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">millis</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">current</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">previous</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2000</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">previous</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">counter</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">counter</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;2&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">taskState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TaskStates</span><span class="o">::</span><span class="n">WAIT_INIT</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">task</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">task</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.IO.Ports</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">TMPro</span><span class="p">;</span><span class="w"></span>

<span class="k">enum</span><span class="w"> </span><span class="n">TaskState</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">INIT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">WAIT_START</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">WAIT_EVENTS</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Serial</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">TaskState</span><span class="w"> </span><span class="n">taskState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">INIT</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">SerialPort</span><span class="w"> </span><span class="n">_serialPort</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">TextMeshProUGUI</span><span class="w"> </span><span class="n">myText</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SerialPort</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">PortName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;/dev/ttyUSB0&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BaudRate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">115200</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">DtrEnable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Open Serial Port&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">buffer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="p">[</span><span class="m">128</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">myText</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">counter</span><span class="p">++;</span><span class="w"></span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">taskState</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">INIT</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="n">taskState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">WAIT_START</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;WAIT START&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">WAIT_START</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">A</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="m">0</span><span class="n">x31</span><span class="p">};</span><span class="w"> </span><span class="c1">// start</span>
<span class="w">                    </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;WAIT EVENTS&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">taskState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">WAIT_EVENTS</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>

<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">WAIT_EVENTS</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">B</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="m">0</span><span class="n">x32</span><span class="p">};</span><span class="w"> </span><span class="c1">// stop</span>
<span class="w">                    </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;WAIT START&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">taskState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">WAIT_START</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BytesToRead</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">numData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">128</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">default</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;State Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>¿Recuerdas las preguntas del otro experimento? Aquí nos pasa lo mismo.
Analicemos el asunto. Cuando preguntas <code class="docutils literal notranslate"><span class="pre">_serialPort.BytesToRead</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> lo
que puedes asegurar es que al MENOS tienes un byte del mensaje, pero
no puedes saber si tienes todos los bytes que lo componen. Una idea
para resolver esto sería hacer que todos los mensajes tengan el mismo
tamaño. De esta manera solo tendrías que preguntar
<code class="docutils literal notranslate"><span class="pre">_serialPort.BytesToRead</span> <span class="pre">&gt;</span> <span class="pre">SIZE</span></code>, donde SIZE sería el tamaño fijo; sin
embargo, esto le resta flexibilidad al protocolo de comunicación.
Nota que esto mismo ocurre en el caso del programa del ESP32 con
<code class="docutils literal notranslate"><span class="pre">Serial.available()</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>.</p>
<p>¿Cómo podrías solucionar este problema?</p>
</section>
<section id="ejercicio-5-caracter-de-fin-de-mensaje">
<h4>Ejercicio 5: carácter de fin de mensaje<a class="headerlink" href="#ejercicio-5-caracter-de-fin-de-mensaje" title="Permalink to this heading"></a></h4>
<p>Ahora vas a analizar cómo puedes resolver el problema anterior.</p>
<p>Analiza el siguiente programa del ESP32:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">String</span><span class="w"> </span><span class="nf">btnState</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btnState</span><span class="p">){</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">btnState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">HIGH</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;OFF&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;ON&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">task</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TaskStates</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">INIT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">WAIT_COMMANDS</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">TaskStates</span><span class="w"> </span><span class="n">taskState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TaskStates</span><span class="o">::</span><span class="n">INIT</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">led</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">button1Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">button2Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">button3Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">button4Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">33</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">taskState</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">TaskStates</span><span class="o">::</span><span class="no">INIT</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">led</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPUT</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">led</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">button1Pin</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT_PULLUP</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">button2Pin</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT_PULLUP</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">button3Pin</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT_PULLUP</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">button4Pin</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT_PULLUP</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">taskState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TaskStates</span><span class="o">::</span><span class="n">WAIT_COMMANDS</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">TaskStates</span><span class="o">::</span><span class="no">WAIT_COMMANDS</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Serial</span><span class="p">.</span><span class="n">readStringUntil</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">command</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;ledON&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">led</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">command</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;ledOFF&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">led</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">command</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;readBUTTONS&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;btn1: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">btnState</span><span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">button1Pin</span><span class="p">)).</span><span class="n">c_str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot; btn2: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">btnState</span><span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">button2Pin</span><span class="p">)).</span><span class="n">c_str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot; btn3: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">btnState</span><span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">button3Pin</span><span class="p">)).</span><span class="n">c_str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot; btn4: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">btnState</span><span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">button4Pin</span><span class="p">)).</span><span class="n">c_str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">task</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">task</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Analiza el siguiente programa del PC:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.IO.Ports</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">TMPro</span><span class="p">;</span><span class="w"></span>

<span class="k">enum</span><span class="w"> </span><span class="n">TaskState</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">INIT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">WAIT_COMMANDS</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Serial</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">TaskState</span><span class="w"> </span><span class="n">taskState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">INIT</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">SerialPort</span><span class="w"> </span><span class="n">_serialPort</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">TextMeshProUGUI</span><span class="w"> </span><span class="n">myText</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SerialPort</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">PortName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;/dev/ttyUSB0&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BaudRate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">115200</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">DtrEnable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">NewLine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Open Serial Port&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">buffer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="p">[</span><span class="m">128</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">myText</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">counter</span><span class="p">++;</span><span class="w"></span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">taskState</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">INIT</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="n">taskState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">WAIT_COMMANDS</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;WAIT COMMANDS&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">TaskState</span><span class="p">.</span><span class="n">WAIT_COMMANDS</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">A</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;ledON\n&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Send ledON&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">S</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;ledOFF\n&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Send ledOFF&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">R</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;readBUTTONS\n&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Send readBUTTONS&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_serialPort</span><span class="p">.</span><span class="n">BytesToRead</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="kt">string</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">_serialPort</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span><span class="w"></span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">response</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>

<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">default</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;State Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="ejercicio-6-retrieval-practice">
<h4>Ejercicio 6: retrieval practice<a class="headerlink" href="#ejercicio-6-retrieval-practice" title="Permalink to this heading"></a></h4>
<p>Con todo lo que has aprendido hasta ahora vas a volver a darle
una mirada al material desde el ejercicio 1. Una iteración más. Pero
la idea de este ejercicio es que le expliques a un compañero
cada ejercicio. Y la misión de tu compañero será hacerte preguntas.</p>
</section>
<section id="reto-1-protocolo-ascii">
<h4>RETO 1: protocolo ASCII<a class="headerlink" href="#reto-1-protocolo-ascii" title="Permalink to this heading"></a></h4>
<p>El reto consiste en implementar un sistema que permita, mediante una
interfaz gráfica, leer y modificar el estado de unos dispositivos externos
a una aplicación interactiva. En este caso los dispositivos serán
un pulsador y un LED. Ten presente que aunque este ejercicio usa
dispositivos simples, los conceptos asociados a su manejo pueden fácilmente
extrapolarse a dispositivos y sistemas más complejos.</p>
<p>Este reto está compuesto de dos partes: aplicación para el PC y aplicación para
el microcontrolador.</p>
<p>Aplicación para el PC:</p>
<ul class="simple">
<li><p>Debes gestionar las comunicaciones seriales y al mismo tiempo mostrar
un contenido digital dinámica que permita observar fácilmente caídas
en el framerate. Si quieres puedes usar la estrategia del contador que
se incremente en cada frame o cambiar por algo que te guste más.</p></li>
<li><p>Implementa una interfaz de usuario compuesta de botones y cajas de texto
para controlar y visualizar.</p></li>
</ul>
<p>Aplicación para el microcontrolador:</p>
<p>La aplicación del microcontrolador debe tener dos tareas. La tarea uno
debe encender y apagar un LED a una frecuencia de 1Hz. La segunda tarea
debe enviar al PC el estado de un sensor digital (pulsador) y modificar
una salida digital (LED, un segundo LED) con la información recibida
desde el PC.</p>
<p>Protocolo de comunicación:</p>
<ul class="simple">
<li><p>El PC SIEMPRE inicia la comunicación solicitando información al
microcontrolador. Es decir, desde la aplicación del PC siempre se solicita
información y el microcontrolador responde.</p></li>
<li><p>Desde el PC se enviarán tres solicitudes: <code class="docutils literal notranslate"><span class="pre">read</span></code>, <code class="docutils literal notranslate"><span class="pre">outON</span></code>, <code class="docutils literal notranslate"><span class="pre">outOFF</span></code>.</p></li>
<li><p>Para enviar los comandos anteriores usarás los botones
de la interfaz de usuario.</p></li>
<li><p>El microcontrolador enviará los siguientes mensajes de respuesta a cada solicitud:</p>
<ul>
<li><p>Respuesta a <code class="docutils literal notranslate"><span class="pre">read</span></code>: <code class="docutils literal notranslate"><span class="pre">estadoEntrada,estadoSalida</span></code>. Donde estadoEntrada y
estadoSalida serán 0 o 1 dependiendo del estado del sensor digital y el estado
actual de la salida. Por tanto, las posibles respuestas serán: 0,0 0,1 1,0 y 1,1.</p></li>
<li><p>Respuesta a <code class="docutils literal notranslate"><span class="pre">outON</span></code> y <code class="docutils literal notranslate"><span class="pre">outOFF</span></code>: <code class="docutils literal notranslate"><span class="pre">estadoSalida</span></code>. Es decir, el
microcontrolador recibe el comando, realiza la orden solicitada y devuelve
el estado en el cual quedó la salida luego de la orden.</p></li>
</ul>
</li>
<li><p>No olvides que DEBES terminar TODOS los mensajes con el carácter NEWLINE (<code class="docutils literal notranslate"><span class="pre">\n</span></code>) para que
ambas partes sepan que el mensaje está completo.</p></li>
</ul>
</section>
<section id="reto-2-modificacion-de-una-aplicacion-interactiva">
<h4>RETO 2: modificación de una aplicación interactiva<a class="headerlink" href="#reto-2-modificacion-de-una-aplicacion-interactiva" title="Permalink to this heading"></a></h4>
<p>Acabas de llegar como recién egresado de entretenimiento digital a
un estudio que acaba de lanzar uno juego que hará historia.
El juego lo puedes clonar de <a class="reference external" href="https://github.com/zigurous/unity-snake-tutorial">este</a>
repositorio.</p>
<p>Tu misión: debes modificar el código del juego para que se pueda jugar
usando los 4 pulsadores del ESP32 y/o el teclado del computador. Lo que quieren
en el estudio es modificar el juego para que cuatro personas puedan
jugarlo interactuando con botones GIGANTES.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>CAMBIO DE ÚLTIMA HORA</p>
<p>Es posible que ya tengas todo funcionando, pero tu jefe te pide
que solo preguntes el estado de los pulsadores
<a class="reference external" href="https://docs.unity3d.com/ScriptReference/Time-deltaTime.html">cada 50 ms</a>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Truco</p>
<p>TUTORIAL</p>
<p>El autor del juego tiene un video tutorial en youtube
<a class="reference external" href="https://youtu.be/U8gUnpeaMbQ">aquí</a></p>
</div>
</section>
</section>
</section>
<section id="evaluacion-de-la-unidad">
<h2>Evaluación de la unidad<a class="headerlink" href="#evaluacion-de-la-unidad" title="Permalink to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>FECHA MÁXIMA DE ENTREGA</p>
<p>jueves 22 de septiembre en la segunda sesión de clase. La evaluación
debe estar en el repositorio y sustentada.</p>
</div>
<section id="enunciado">
<h3>Enunciado<a class="headerlink" href="#enunciado" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Realiza una aplicación interactiva en Unity que te permita controlar 3 LEDs y
leer el estado de 3 pulsadores.</p></li>
<li><p>La aplicación debe tener la siguiente interfaz de usuario:</p>
<a class="reference internal image-reference" href="../_images/evalUI.png"><img alt="App UI" class="align-center" src="../_images/evalUI.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</li>
</ul>
</section>
<section id="que-debes-entregar">
<h3>¿Qué debes entregar?<a class="headerlink" href="#que-debes-entregar" title="Permalink to this heading"></a></h3>
<p>El código fuente de las aplicaciones para el microcontrolador y para Unity en
<a class="reference external" href="https://classroom.github.com/a/UBJPVkq9">este</a> repositorio.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="../_unidad1/referentes.html" class="btn btn-neutral float-left" title="Unidad 1. Software para sistemas embebidos" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2022, Juan Franco.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>